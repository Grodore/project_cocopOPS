---
schemaVersion: 2.0.0

fileExistenceTests:
    - name: main file
      path: /main.py
      shouldExist: true
    - name: config directory
      path: /config
      shouldExist: true
    - name: routes directory
      path: /routes
      shouldExist: true
    - name: venv directory
      path: .venv
      shouldExist: true
    - name: uv binary
      path: /usr/local/bin/uv
      shouldExist: false
    - name: uv.lock file
      path: uv.lock
      shouldExist: false
    - name: pyproject.toml file
      path: pyproject.toml
      shouldExist: false
    # Tests de présence de fichiers supplémentaires
    - name: settings file
      path: /config/settings.py
      shouldExist: true
    - name: logs directory
      path: /logs
      shouldExist: true

fileContentTests:
    - name: check main.py content
      path: /main.py
      expectedContents: ["if __name__ == '__main__':"]

fileModeTests:
    - name: check config directory permissions
      path: /config
      expectedMode: "755"
    - name: check main.py permissions
      path: /main.py
      expectedMode: "644"

commandTests:
    - name: python version
      command: python
      args: [--version]
      expectedOutput: [Python 3.12.*]
    - name: python path
      command: which
      args: [python]
      expectedOutput: [/.venv/bin/python*]
    - name: whoami
      command: whoami
      expectedOutput: [nonroot]
    - name: check user id
      command: id
      args: [-u]
      expectedOutput: [65532]
    - name: check group id
      command: id
      args: [-g]
      expectedOutput: [65532]
    # Tests de commandes supplémentaires
    - name: check pip version
      command: pip
      args: [--version]
      expectedOutput: [pip 21.*]
    - name: check application start
      command: python
      args: [main.py]
      expectedOutput: ["Application started"]

metadataTest:
    exposedPorts: ["8501"]
    envVars:
      - key: PATH
        value: /.venv/bin.*
        isRegex: true
      - key: PYTHONPATH
        value: "/.venv/lib/python3.12/site-packages"
      # Tests de variables d'environnement supplémentaires
      - key: APP_ENV
        value: "development"
      - key: LOG_LEVEL
        value: "info"
